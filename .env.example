# ══════════════════════════════════════════════════════════════════
# crypto-agent — Environment Variables
# ══════════════════════════════════════════════════════════════════
# Copy this file to .env and fill in all values before running.
#
#   cp .env.example .env
#
# NEVER commit .env to version control.
# All values marked REQUIRED must be set or the app will not start.
# Values marked OPTIONAL have safe defaults and can be left as-is.
# ══════════════════════════════════════════════════════════════════


# ── Anthropic ─────────────────────────────────────────────────────
# REQUIRED — Get this from https://console.anthropic.com
ANTHROPIC_API_KEY=sk-ant-api03-...

# OPTIONAL — Model to use for the agent orchestrator
# Do not change this unless you know what you are doing.
CLAUDE_MODEL=claude-opus-4-6


# ── PostgreSQL / TimescaleDB ──────────────────────────────────────
# REQUIRED — Used for storing OHLCV data, trade logs, and audit trail.
# The Docker Compose service uses these values directly.
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=crypto_agent
POSTGRES_USER=agent
POSTGRES_PASSWORD=changeme_use_a_strong_password

# Full connection URL assembled from the above — used by SQLAlchemy.
# If you change any of the above, update this too.
POSTGRES_URL=postgresql://agent:changeme_use_a_strong_password@localhost:5432/crypto_agent


# ── Redis ─────────────────────────────────────────────────────────
# REQUIRED — Used for real-time feature caching and latest price storage.
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_URL=redis://localhost:6379

# OPTIONAL — Set a password if your Redis instance is exposed publicly.
# Leave blank for local/Docker setups behind a firewall.
REDIS_PASSWORD=


# ── ChromaDB ─────────────────────────────────────────────────────
# REQUIRED — Vector database for agent research memory.
# Runs as a Docker service on the default port.
CHROMA_HOST=localhost
CHROMA_PORT=8000


# ── Binance ───────────────────────────────────────────────────────
# REQUIRED — Used for market data ingestion and order execution.
#
# Setup instructions:
#   1. Go to https://www.binance.com/en/my/settings/api-management
#   2. Create a new API key
#   3. Enable "Enable Futures" permission
#   4. Enable "Enable Reading" permission
#   5. For live trading also enable "Enable Spot & Margin Trading"
#   6. Restrict access to your server's IP address for security
#   7. NEVER enable "Enable Withdrawals"
#
BINANCE_API_KEY=your_binance_api_key_here
BINANCE_SECRET=your_binance_secret_here

# OPTIONAL — Switch to testnet for safe development and testing.
# Set to "true" to use Binance Futures Testnet (https://testnet.binancefuture.com)
# Set to "false" for live trading.
BINANCE_TESTNET=true

# OPTIONAL — Default exchange used throughout the system.
# Supported values: binance, coinbase, kraken, bybit
DEFAULT_EXCHANGE=binance


# ── TradingView ───────────────────────────────────────────────────
# REQUIRED — Passphrase included in every TradingView webhook payload.
# The API server rejects any webhook request that does not include
# this exact value. Choose a long random string and keep it secret.
#
# Generate one with: python -c "import secrets; print(secrets.token_urlsafe(32))"
#
TV_WEBHOOK_PASSPHRASE=replace_with_a_long_random_string


# ── Risk Management ───────────────────────────────────────────────
# OPTIONAL — Hard risk limits enforced by the signal engine.
# These are applied regardless of what the AI agent decides.

# Maximum portfolio drawdown from peak before all trading halts.
# 0.15 = 15%. Agent cannot override this.
MAX_DRAWDOWN_KILL=0.15

# Maximum number of open positions at any one time.
MAX_CONCURRENT_POSITIONS=5

# Kelly fraction for position sizing.
# 0.25 = quarter-Kelly (conservative and recommended).
# 0.5 = half-Kelly. Never use full Kelly (1.0) in live trading.
KELLY_FRACTION=0.25

# Maximum position size as a percentage of portfolio per trade.
MAX_POSITION_SIZE_PCT=0.05


# ── Research Loop ─────────────────────────────────────────────────
# OPTIONAL — Controls the autonomous research cycle behaviour.

# How often the research loop fires automatically (in minutes).
# 60 = once per hour. Set higher during initial testing.
RESEARCH_CYCLE_INTERVAL_MINUTES=60

# Maximum number of research cycles to run per session before stopping.
# Prevents runaway API usage. Set to 0 for unlimited.
RESEARCH_MAX_CYCLES_PER_SESSION=10

# Minimum Sharpe ratio for a strategy to be promoted to paper trading.
MIN_BACKTEST_SHARPE=1.5

# Maximum drawdown allowed for a strategy to be promoted.
# 0.12 = 12%
MAX_BACKTEST_DRAWDOWN=0.12

# Minimum number of trades a backtest must generate to be considered valid.
# Prevents strategies that barely trade from being promoted.
MIN_BACKTEST_TRADES=50

# Maximum overfitting score (in-sample vs out-of-sample Sharpe gap).
# Strategies above this threshold are discarded.
MAX_OVERFITTING_SCORE=0.4


# ── Backtester Defaults ───────────────────────────────────────────
# OPTIONAL — Default parameters used by the backtester.

# Default lookback period in days for backtests.
DEFAULT_LOOKBACK_DAYS=730

# Default candle timeframe.
# Supported: 1m, 5m, 15m, 1h, 4h, 1d
DEFAULT_TIMEFRAME=1h

# Exchange fees used in backtesting simulation (taker fee).
# 0.001 = 0.1% (Binance Futures standard taker fee)
BACKTEST_FEE=0.001

# Simulated slippage per trade.
BACKTEST_SLIPPAGE=0.0005

# Assets tested in every backtest by default (comma-separated).
DEFAULT_ASSETS=BTC/USDT,ETH/USDT,SOL/USDT,BNB/USDT,AVAX/USDT


# ── API Server ────────────────────────────────────────────────────
# OPTIONAL — FastAPI server configuration.
API_HOST=0.0.0.0
API_PORT=8080

# Secret key for signing any internal JWT tokens.
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(64))"
API_SECRET_KEY=replace_with_a_long_random_secret_key

# OPTIONAL — Set to "false" in production to disable Swagger UI (/docs).
API_DOCS_ENABLED=true


# ── Grafana ───────────────────────────────────────────────────────
# OPTIONAL — Monitoring dashboard credentials.
# Change the default password before exposing Grafana to the internet.
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=changeme


# ── Logging ───────────────────────────────────────────────────────
# OPTIONAL — Application log level.
# Supported: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# OPTIONAL — Set to "true" to write logs to a file in addition to stdout.
LOG_TO_FILE=false
LOG_FILE_PATH=./logs/crypto_agent.log


# ══════════════════════════════════════════════════════════════════
# NOTES
# ══════════════════════════════════════════════════════════════════
#
# Start with BINANCE_TESTNET=true and paper trade for at least
# 2-4 weeks before switching to live funds.
#
# The agent will not place live orders until:
#   1. BINANCE_TESTNET is set to false
#   2. A strategy has been promoted (Sharpe > MIN_BACKTEST_SHARPE)
#   3. The strategy has passed paper trading validation
#
# If in doubt, leave BINANCE_TESTNET=true. The research loop and
# backtesting engine work identically on testnet.
# ══════════════════════════════════════════════════════════════════
